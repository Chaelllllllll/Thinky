<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Thinky</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">
    
    <style>
        body {
            background: var(--light-gray);
        }

        .admin-header {
            background: var(--gradient-accent);
            color: white;
            padding: 32px;
            margin-bottom: 32px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .analytics-card {
            background: white;
            padding: 24px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--primary-pink);
            transition: all var(--transition-base);
        }

        .analytics-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        /* Compact badge variant for analytics cards */
        .analytics-card.badge {
            padding: 12px 16px;
            border-radius: 12px;
            min-height: 72px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            border-left-width: 3px;
        }
        .analytics-card.badge .analytics-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-pink);
            margin-bottom: 6px;
        }
        .analytics-card.badge .analytics-label {
            font-size: 0.82rem;
            color: var(--dark-gray);
            margin: 0;
        }

        .analytics-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-pink);
        }

        .analytics-label {
            color: var(--dark-gray);
            font-size: 0.9rem;
            margin-top: 4px;
        }

        .admin-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 12px 24px;
            background: white;
            border: 2px solid var(--medium-gray);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all var(--transition-base);
            font-weight: 500;
        }

        .admin-tab.active {
            background: var(--gradient-accent);
            color: white;
            border-color: var(--accent-pink);
        }

        .admin-tab:hover:not(.active) {
            background: var(--secondary-pink);
            border-color: var(--primary-pink);
        }

        .data-table {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .table-header {
            background: var(--light-gray);
            padding: 16px 24px;
            border-bottom: 2px solid var(--medium-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: var(--secondary-pink);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-dark);
        }

        td {
            padding: 16px;
            border-bottom: 1px solid var(--medium-gray);
        }

        tr:hover {
            background: var(--light-gray);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .search-filter {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-filter input {
            flex: 1;
            min-width: 200px;
        }

        @media (max-width: 768px) {
            .analytics-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.875rem;
            }

            th, td {
                padding: 12px 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-brand">Thinky</h2>
        </div>
        <nav class="sidebar-nav">
            <a href="/admin-users.html" class="sidebar-link">
                <i class="bi bi-people"></i>
                <span>Users</span>
            </a>
            <a href="/admin-reviewers.html" class="sidebar-link">
                <i class="bi bi-journal-text"></i>
                <span>Reviewers</span>
            </a>
            <a href="/admin-moderation.html" class="sidebar-link">
                <i class="bi bi-flag"></i>
                <span>Reviewer Moderation</span>
            </a>
            <a href="/admin-message-moderation.html" class="sidebar-link">
                <i class="bi bi-chat-left-text"></i>
                <span>Message Moderation</span>
            </a>
            <a href="#" onclick="showPolicySection(); return false;" class="sidebar-link">
                <i class="bi bi-shield-shaded"></i>
                <span>Policies</span>
            </a>
            <!-- Removed non-admin links: My Dashboard, Chat, Public Reviewers -->
            <div style="margin-top: auto; padding-top: 24px;">
                <button onclick="logout()" class="sidebar-link w-100" style="border: none; background: none; text-align: left;">
                    <i class="bi bi-box-arrow-right"></i>
                    <span>Logout</span>
                </button>
            </div>
        </nav>
    </div>

    <!-- Mobile Toggle -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <i class="bi bi-list"></i>
    </button>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Admin Header -->
        <div class="admin-header">
            <h1 style="margin: 0; color: white;"><i class="bi bi-shield-check"></i> Admin Dashboard</h1>
            <p style="margin: 8px 0 0 0; opacity: 0.9;">Manage users, reviewers, and chat messages</p>
        </div>

        <!-- Analytics Section -->
        <div class="analytics-grid" id="analyticsGrid">
            <div class="analytics-card badge">
                <div class="analytics-value" id="totalUsers">0</div>
                <div class="analytics-label">Total Users</div>
            </div>
            <div class="analytics-card badge">
                <div class="analytics-value" id="totalStudents">0</div>
                <div class="analytics-label">Students</div>
            </div>
            <div class="analytics-card badge">
                <div class="analytics-value" id="totalAdmins">0</div>
                <div class="analytics-label">Admins</div>
            </div>
            <div class="analytics-card badge">
                <div class="analytics-value" id="totalSubjects">0</div>
                <div class="analytics-label">Subjects</div>
            </div>
            <div class="analytics-card badge">
                <div class="analytics-value" id="totalReviewers">0</div>
                <div class="analytics-label">Reviewers</div>
            </div>
            <div class="analytics-card badge">
                <div class="analytics-value" id="onlineUsers">0</div>
                <div class="analytics-label">Online Now</div>
            </div>
        </div>

        <!-- Header tabs removed (Users / Reviewers / Moderation pills) -->

        <!-- Users Tab -->
        <div id="usersTab" class="tab-content active">
            <div class="data-table">
                <div class="table-header">
                    <h3 style="margin: 0;">User Management</h3>
                    <div style="display:flex;gap:8px;align-items:center;">
                        <label for="roleFilter" style="margin:0 8px 0 0;color:var(--dark-gray);">Role</label>
                        <select id="roleFilter" class="form-control" onchange="filterUsers()" style="min-width:160px;">
                            <option value="all">All Roles</option>
                            <option value="student">Student</option>
                            <option value="moderator">Moderator</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                </div>
                <div style="padding: 20px;">
                    <div class="search-filter">
                        <input 
                            type="text" 
                            class="form-control" 
                            id="userSearch" 
                            placeholder="Search users by email or username..."
                            oninput="filterUsers()"
                        >
                    </div>
                    <div style="overflow-x: auto;">
                        <table id="usersTable">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Verified</th>
                                    <th>Joined</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 40px;">
                                        <div class="spinner"></div>
                                        <p style="margin-top: 16px; color: var(--dark-gray);">Loading users...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Moderation Tab -->
        <div id="moderationTab" class="tab-content">
            <div class="data-table">
                <div class="table-header">
                    <h3 style="margin: 0;">Reviewer Moderation Queue</h3>
                </div>
                <div style="padding: 20px; overflow-x:auto;">
                    <table id="moderationTable">
                        <thead>
                            <tr>
                                <th>Reported User</th>
                                <th>Reporter</th>
                                <th>Violation Type</th>
                                <th>Message / Details</th>
                                <th>Created</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="moderationTableBody">
                            <tr><td colspan="6" style="text-align:center;padding:20px;">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Reviewers Tab -->
        <div id="reviewersTab" class="tab-content">
            <div class="data-table">
                <div class="table-header">
                    <h3 style="margin: 0;">Reviewer Management</h3>
                </div>
                <div style="padding: 20px;">
                    <div class="search-filter">
                        <input 
                            type="text" 
                            class="form-control" 
                            id="reviewerSearch" 
                            placeholder="Search reviewers..."
                            oninput="filterReviewers()"
                        >
                    </div>
                    <div style="overflow-x: auto;">
                        <table id="reviewersTable">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Subject</th>
                                    <th>Author</th>
                                    <th>Public</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="reviewersTableBody">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 40px;">
                                        <div class="spinner"></div>
                                        <p style="margin-top: 16px; color: var(--dark-gray);">Loading reviewers...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Policies Tab -->
        <div id="policiesTab" class="tab-content" style="display:none;">
            <div class="data-table">
                <div class="table-header">
                    <h3 style="margin: 0;"><i class="bi bi-shield-shaded"></i> Policy Management</h3>
                    <button class="btn btn-primary" onclick="openAddPolicyModal()">
                        <i class="bi bi-plus-lg"></i> Add Policy
                    </button>
                </div>
                <div style="padding: 20px;">
                    <div class="search-filter" style="margin-bottom:16px;">
                        <select id="policyFilterCategory" class="form-control" onchange="filterPolicies()" style="max-width:200px;">
                            <option value="all">All Categories</option>
                            <option value="reviewer">Reviewer</option>
                            <option value="message">Message</option>
                            <option value="both">Both</option>
                        </select>
                    </div>
                    <div style="overflow-x: auto;">
                        <table id="policiesTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Title</th>
                                    <th>Description</th>
                                    <th>Category</th>
                                    <th>Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="policiesTableBody">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 40px;">
                                        <div class="spinner"></div>
                                        <p style="margin-top: 16px; color: var(--dark-gray);">Loading policies...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Messages tab removed from admin UI -->
    </div>

    <script src="/js/alerts.js"></script>
    <script src="/js/modalAlerts.js"></script>
    <script src="/js/admin.js"></script>
    
    <!-- Add/Edit Policy Modal -->
    <div id="policyModal" class="modal">
        <div class="modal-content" style="max-width:700px;">
            <div class="modal-header">
                <h3 class="modal-title" id="policyModalTitle">Add New Policy</h3>
                <button class="modal-close" onclick="closePolicyModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="policyForm">
                    <input type="hidden" id="policyId">
                    <div class="form-group">
                        <label for="policyTitle">Policy Title <span style="color:red;">*</span></label>
                        <input id="policyTitle" class="form-control" placeholder="e.g., Spam or Repetitive Content" required>
                    </div>
                    <div class="form-group">
                        <label for="policyDescription">Description <span style="color:red;">*</span></label>
                        <textarea id="policyDescription" class="form-control" rows="4" placeholder="Detailed explanation of the policy..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="policyCategory">Category <span style="color:red;">*</span></label>
                        <select id="policyCategory" class="form-control" required>
                            <option value="">Select category...</option>
                            <option value="reviewer">Reviewer Content Only</option>
                            <option value="message">Chat Messages Only</option>
                            <option value="both">Both (Reviewer & Messages)</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" onclick="closePolicyModal()">Cancel</button>
                <button id="savePolicyBtn" class="btn btn-primary" onclick="savePolicy()">Save Policy</button>
            </div>
        </div>
    </div>
    
    <!-- Edit User Modal -->
    <div id="editUserModal" class="modal">
        <div class="modal-content" style="max-width:640px;">
            <div class="modal-header">
                <h3 class="modal-title">Edit User</h3>
                <button class="modal-close" onclick="closeEditUserModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editUserForm">
                    <input type="hidden" id="editUserId">
                    <div class="form-group">
                        <label for="editDisplayName">Display Name</label>
                        <input id="editDisplayName" class="form-control" placeholder="Display name">
                    </div>
                    <div class="form-group">
                        <label for="editUsername">Username</label>
                        <input id="editUsername" class="form-control" placeholder="Username">
                    </div>
                    <div class="form-group">
                        <label for="editEmail">Email</label>
                        <input id="editEmail" class="form-control" placeholder="Email">
                    </div>
                    <div class="form-group">
                        <label for="editRole">Role</label>
                            <select id="editRole" class="form-control">
                            <option value="student">Student</option>
                            <option value="moderator">Moderator</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" id="editVerified"> Verified</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" onclick="closeEditUserModal()">Cancel</button>
                <button id="saveUserChangesBtn" class="btn btn-primary">Save Changes</button>
            </div>
        </div>
    </div>
</body>
</html>
